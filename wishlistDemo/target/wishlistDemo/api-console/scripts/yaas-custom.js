'use strict';

jQuery(function ($) {


    //
    // copy API title to the title of the HTML document
    //

    function apiTitleHandler() {
        var apiTitle = $(this).text();
        if (apiTitle) {
            if (document.title) {
                document.title = apiTitle + ' - ' + document.title;
            }
            else {
                document.title = apiTitle;
            }
        }
    }

    $('body').one('DOMSubtreeModified', 'main h1.raml-console-title', apiTitleHandler);

    // invoke handler function right away, in case the API title was loaded before the above handler was attached
    ($.proxy(apiTitleHandler, $('body main h1.raml-console-title').get(0)))();

    (function(){
        var intervalTabsDisplayed = setInterval(addListener, 1000);

        function hideSensitiveData() {
            maskElementById("client_secret");
            maskElementById("password");
        }

        function maskElementById(elementId) {
            var element = document.getElementById(elementId);
            if (element) {
                element.setAttribute("type", "password");
            }
        }

        //triggers hideSensitiveData function only once the content generated by angular is really loaded
        function triggerOnTabClick(){
            setTimeout(hideSensitiveData, 1000);
        }

        function addListener(){
            //get the array of all the tab elements in the console
            var tab = document.getElementsByClassName("raml-console-tab");

            if(tab.length !== 0){
                clearInterval(intervalTabsDisplayed);
                for (var i = 0; i < tab.length; i++) {
                    tab[i].addEventListener('click', triggerOnTabClick);
                }
            }
        }
    })();

});
